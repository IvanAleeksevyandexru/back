# Сборка

Для сборки приложения необходимо выполнить команду:

    mvn clean package

После сборки в папке `target` должен появится файл `pgu-kafka-cli.jar` 

# Запуск

Для запуска приложения можно использовать команду

    java -jar pgu-kafka-cli.jar

# Конфигурация

Конфигурационный файл должен располагаться в текущей рабочей директории (`pwd`).
Файл должен иметь наименование `application.yaml` 
и содержать конфигурацию в формате YAML.

Например, если расположить файл приложения в папке `/home/user/pgu-kafka-cli` 
в ней также можно создать файл конфигурации:

    /home/user/pgu-kafka-cli
    ├ pgu-kafka-cli.jar
    └ application.yaml

Пример конфигурационного файла `application.yaml`:

    spring:
        kafka:
            bootstrap-servers: localhost:9092
    app:
        topic: self-errors
        dest: sp-adapter
        serviceId:
            include: 10000000101
            exclude: 10000000106, 10000000103
        restart: false
        readUntilTimeout: false        
        timeout: PT2S

Любой из параметров может быть переопределен через командную строку.

Например:

    java -jar pgu-kafka-cli.jar --spring.kafka.bootstrap-servers=10.81.4.30:14436,10.81.4.30:14437,10.81.4.30:14338

Далее идет список параметров с их описанием

## `spring.kafka.bootstrap-servers`

Список серверов для подключения к Kafka (не ZooKeeper)

Например:

    spring.kafka.bootstrap-servers=10.81.4.30:14436,10.81.4.30:14437,10.81.4.30:14338

## `app.topic`

Топик из которого читать сообщения

Например:

    app.topic: self-errors

## `app.dest`

Топик в который отправлять сообщения

Например:

    app.dest: sp-adapter

## `app.service-id.include`

Фильтр по `serviceId`, 
повторно отправлены будут только те сообщения, 
которые входят в указанный список

Например:

    app.service-id.include: 10000000101

Для того чтобы сбросить фильтр, достаточно указать пустой список:

    app.service-id.include:

## `app.service-id.exclude`

Список исключений по `serviceId`,
повторно отправлены будут только сообщения
которые **НЕ** входят в указанный список (разделенный запятыми)

Например:

    app.service-id.exclude: 10000000106,10000000103

Для того чтобы сбросить фильтр, достаточно указать пустой список:

    app.service-id.exclude:

## `app.order-id.include`

Фильтр по `orderId`,
повторно отправлены будут только те сообщения,
которые входят в указанный список

Например:

    app.order-id.include: 15326256326

Для того чтобы сбросить фильтр, достаточно указать пустой список:

    app.order-id.include:

## `app.order-id.exclude`

Список исключений по `orderId`,
повторно отправлены будут только сообщения
которые **НЕ** входят в указанный список (разделенный запятыми)

Например:

    app.order-id.exclude: 10000000106, 10000000103

Для того чтобы сбросить фильтр, достаточно указать пустой список:

    app.order-id.exclude:

## `app.restart`

Сброс `offset` в Kafka.

### ВНИМАНИЕ!!!

Это приведет к повторной отправке 
всех сообщений в топике - даже уже повторно отправленных

Например:

    app.restart: true

## `app.read-until-timeout` 

Флаг, означающий, что необходимо дожидаться всех сообщений в топике. 
Иначе будут прочитаны только те сообщения которые были в топике 
на момент запуска приложения.

Например:

    app.read-until-timeout: false

## `app.timeout`

Таймаут для ожидания дополнительных сообщений в топике. 
В случае если за это время в топике не будет добавлено ни одного 
сообщений выполнение программы будет завершено.

Формат: https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#parse-java.lang.CharSequence-

Например,

Ожидание 2 секунды перед завершением приложения:

    app.timeout: PT2S

## `app.timestamp.since`

Фильтр по полю `timestamp`.
Означает минимальное значение `timestamp`

Описание формата [здесь](#формат-даты-и-времени) 

Например:

    app.timestamp.since: 2005-08-09T18:31:42.421+03:00

## `app.timestamp.until`

Фильтр по полю `timestamp`.
Означает максимальное значение `timestamp`.

Описание формата [здесь](#формат-даты-и-времени)

Указывается в формате ISO 8601 (см. https://ru.wikipedia.org/wiki/ISO_8601).

Например:

    app.timestamp.until: 2020-04-01T01:20Z

## `app.logAll`

Логирование всех сообщений или только тех которые подходят по фильтру

Например:

    app.logAll: true

## `app.dryRun`

Запуск без фактической переотправки в `dest` - только логирование

Например:

    app.dryRun: true

## Формат даты и времени

Дата и время в конфигурации указываются в следующем формате:

    YYYY-MM-dd'T'HH:mm[:ss[.SSS]]('Z'|[+/-]HH:mm:ss)

где

    YYYY - год
    MM - месяц
    dd - день
    HH - час (24 часовой вид)
    mm - минуты
    [ss] - секунды - опционально могут быть пропущены
    [SSS] - миллисекунды - опционально могут быть пропущены
    'Z'|[+/-]HH:mm:ss - смещение часового пояса

Примеры:

    2021-10-01T15:00+03:00 <-- 1 октября 2021 15:00 по МСК
    2021-10-01T15:00:10Z <-- 1 октября 2021 15:00:10 по GMT (UTC)
    2021-10-01T15:00:00.999+03:00 <-- 1 октября 2021 15:00:00.999 по МСК 
