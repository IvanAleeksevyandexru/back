# JsonLogic

Механизм для вычисления значений на основе логики, описанной в json

## Типы аргументов

### Примитивные типы из спецификации json:

- String
- Number (При парсинге будет преобразован в double)
- Boolean

### Сложные типы:

#### String

```json
{
  "value": "Hello",
  "type": "String"
}
```

Если тип не указан, по умолчанию будет String

```json
{
  "value": "Hello"
}
```

#### Date

Параметр accuracy отвечает за точность сравнения (day, month, year). Параметр add отвечает за добавление к дате лет,
месяцев, дней.

```json
{
  "value": "2021-11-18",
  "type": "Date",
  "accuracy": "day",
  "add": {
    "year": -1,
    "month": 1,
    "day": 2
  }
}
```

### Ссылки

#### Ссылка на ответ пользователя из scenarioDto

```"answer.pd1.value.storedValues.lastName"```

#### Ссылка на protectedField из ЕСИА данных пользователя

```"protected.birthDate"```

#### Ссылка на глобальную переменную

```"variable.today"```

## Операторы

### Логическое И, ИЛИ

Принимает массив из двух аргументов

```json
{
  "or": [
    true,
    false
  ]
} 
```

Результат: true

```json
{
  "and": [
    true,
    true
  ]
}
```

Результат: true

### Логическое НЕ

Принимает массив из одного аргумента

```json
{
  "not": [
    true
  ]
}
```

Результат: false

### Операторы сравнения

<, >, <=, >=, ==, != Принимают массив из двух аргументов. Если передать аргументы разных типов, перед сравнением будет
попытка их приведения.

```json
{
  "==": [
    "2020-12-20",
    {
      "value": "2021-11-18",
      "type": "Date",
      "accuracy": "",
      "add": {
        "year": -1,
        "month": 1,
        "day": 2
      }
    }
  ]
} 
```

Результат: true

```json
{
  "<=": [
    1,
    1
  ]
} 
```

Результат: true

### Условный оператор

Принимает массив из трех аргументов:

- условие
- что делать если условие true
- что делать если условие false

```json
{
  "if": [
    true,
    "yes",
    "no"
  ]
} 
```

Результат: "yes"

Второй и третий аргумент могут иметь вложенные условия if

```json
{
  "if": [
    true,
    {
      "if": [
        false,
        "yes",
        "maybe"
      ]
    },
    "no"
  ]
}
```

Результат: "maybe"

Оператор if может принимать более 3 аргументов, связывая их парами. Последний непарный аргумент будет значением по
умолчанию.

```json
{
  "if" : [
     {"<": [1, 0] }, "one",
     {"and": [true, false]}, "two",
     "three"
   ]
}
``` 
Результат: "three"

## Пример использования

В linkedValues добавлен механизм jsonLogic

```json
{
  "id": "w1",
  "type": "InfoScr",
  "label": "</p>${TEXT} способ получения назначенной пенсии или социальных выплат</p>",
  "linkedValues": [
    {
      "argument": "TEXT",
      "jsonLogic": {
        "if": [
          {
            "==": [
              {"value": "answer.ai7.value"},
              0
            ]
          },
          "ноль",
          {
            "==": [
              "answer.ai7.value",
              1
            ]
          },
          "один",
          "много"
        ]
      }
    }
  ]
}
```